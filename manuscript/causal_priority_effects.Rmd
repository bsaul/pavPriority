---
title: Causal Priority Effects
authors:
- name: Bradley Saul
- name: Fletcher Halliday
output: 
  pdf_document
header-includes: 
- \usepackage{mathtools}
- \usepackage{tikz}
- \usepackage{graphicx}
- \usepackage{xcolor}
- \newcommand*\circled[1]{\tikz[baseline=(char.base)]{
     \node[shape=circle,draw,inner sep=2pt] (char) {#1};}}
bibliography: "priority_effects.bib"
abstract: TBD
---

# Introduction

The early bird gets the worm, but the second mouse gets the cheese. Despite being poorly understood and studied, priority effects -- the order and timing of species arrival -- have ecological consequences [@fukami2015historical]. Priority effects invite counterfactual reasoning: if species A arrives first would outcomes for species B be different compared to a world where species B arrived first? Such counterfactual questions are well-suited for the potential framework of causal inference [@vanderweele2015explanation]. 

To study within-host priority effects, @halliday2017interactions conducted an experiment wherein three cohorts of sentinel, pathogen-naive tall fescue (*Festuca arundinacea*) plants where placed in a field at three different timepoints during the year. The timepoints were chosen to correspond to periods of high prevelance during the annual epidemic cycles for each of three tall fescue fungal pathogens: *Colletotrichum* (early summer), *Rhizoctonia* (mid summer), and *Puccinia* (late summer) [@halliday2017interactions]. 

In this paper, priority effects are defined as contrasts of potential outcomes, hence under assumptions that we detail these effects have a causal interpretation and may be estimated from observed data. 

## Priority Effects

Describe priority effects and importance to ecology (based on @fukami2015historical)


* would be nice to map one of the figures in @fukami2015historical to the causal graph

## Causal inference using potential outcomes

Structural equation models [@shipley2016cause] are popular in biology and ecology; however, parameters from these models may not carry a causal interpretation without assumptions often implicitly made [@imai2010general]. Similarly, it is not uncommon for authors to discuss the results of associational statistical models in terms of causal language. In this paper, we begin by explicitly define causal questions in terms of potential outcomes and work forward from there. An advantage of the potential outcome approach is that the causal effects can be defined, identified, and estimators derived without reference to specific statistical models [@imai2010general]. 

# Discrete-Time Causal Models for Within-Host Priority Effects

A goal of the model is to make comparisons such as: 

*Direct effects*

* how does the risk of Rhizoc infection change had the leaf not been infected by Collec at the previous timepoint *versus* not having been infected by Collec, holding within-plant Rhizoc intensity and within-plant Coll intensity fixed.
* how does the risk of Coll infection change had the leaf not been infected by Rhizoc at the previous timepoint *versus* not having been infected by Rhizoc, holding within-plant Rhizoc intensity and within-plant Coll intensity fixed.

*Within-plant spillover effects*

* how does the risk of Rhizoc infection change had the within-plant Rhizoc intensity been $X$ versus $X'$ and within-plant Coll intensity fixed and not having been infected by Collec


## Notation

* TODO Define within-plant pressure parameters: 


Define $A_{ijt} = (C_{ijt}, R_{ijt}, P_{ijt})^\intercal$ be the indicators of observed infection status by pathogens *Colletotrichum*, *Rhizoctonia*, and *Puccinia* at weeks $t > 0$ after leaf emergence on leaf $j = 1, \dots, n_i$ in plant $i = 1, \dots, m$. Let $t = 0$ be the first week the leaf emergence. Let $L_{ijt}$ be covariates measured in the time up to the timepoint $t$, $D_{ijt}$ be an indicator that a leaf is alive (1) or not (0) at $t$, and $H_{i} \in \{1, 2, 3\}$ indicate plant $i$'s randomly assigned cohort.

Denote the random matrix of infection exposures for all $n_{i}$ leaves in plant $i$ at time $t$ as $A_{it} = (A_{i1t} , \dots, A_{in_it})$, and let $A_{i\setminus j, t}$ be the submatrix of $A_{it}$ of exposure for all leaves other than the $j$th one. Lower-case letters denote possible realizations of $A_{ijt}$, $A_{i\setminus j, t}$, and $A_i$:   $a_{ijt}$, $a_{i\setminus j, t}$ and $a_{it}$, respectively. Define $\omega(a_{t}; \rho) = \Pr_{\rho}(A_{it} = a_{t})$ as the marginal probability under within-plant pressure $\rho = (\rho^c_{t-1}, \rho^r_{t-1}, \rho^p_{t-1})$ that a host plant experiences $a_t$ at time $t$. 

## Causal effects (estimands)

For each $t$, the average potential outcomes are defined for each pathogen under the case that the pathogen infection statuses had been $a_{t - 1} = (c_{t -1}, r_{t-1}, p_{t-1})$ and the within-host pressure had been $\rho$ in the previous week. Additionally, we define this estimand as conditional upon not having add been previously infected by the same pathogen, not having died, and the cohort assignment. Death is a competing risk, so the estimand is defined on being conditional the leaves alive at time $t$. Also, as we may expect the effects to be different across cohorts, we define the effects to be different. But we do not define the potential outcomes as functions of the cohort since we do not think that the underlying causal processes are dependent on the timing of the cohort's placement in the field.

\begin{align*}
\begin{pmatrix}
  \mu^c_{ht}(a_{t-1}, \rho) \\
  \mu^r_{ht}(a_{t-1}, \rho) \\
  \mu^p_{ht}(a_{t-1}, \rho) 
\end{pmatrix} &= E
\left\{ 
\begin{array}{l}
  \bar{C}_{t}(a_{t-1}, \rho) | C_{t-1} = 0, D_t = 0, H = h \\
  \bar{R}_{t}(a_{t-1}, \rho) | R_{t-1} = 0, D_t = 0, H = h \\ 
  \bar{P}_{t}(a_{t-1}, \rho) | P_{t-1} = 0, D_t = 0, H = h
\end{array}
\right\} \\
&= 
E \left\{
\begin{array}{l}
  \sum_{\mathbf{a}_{i \setminus j}} C_{t}(a_{t-1}; \rho) \omega(a_{t-1}; \rho) | C_{t-1} = 0, D = 0, H = h \\
  \sum_{\mathbf{a}_{i \setminus j}} R_{t}(a_{t-1}; \rho) \omega(a_{t-1}; \rho) | R_{t-1} = 0, D = 0, H = h \\ 
  \sum_{\mathbf{a}_{i \setminus j}} P_{t}(a_{t-1}; \rho) \omega(a_{t-1}; \rho) | P_{t-1} = 0, D = 0, H = h
\end{array}
\right\}
,
\end{align*}

where $\sum_{\mathbf{a}_{i \setminus j}} \equiv \sum_{\mathbf{r}_{i \setminus j}} \sum_{\mathbf{c}_{i\setminus j}} \sum_{\mathbf{p}_{i\setminus j}}$ and $E(\cdot)$ is the expected value in the super-population of plants.



| Name of effect   | Causal contrast | Description  |  
|----------|------------| -------------|
| Average Leaf-level R on C  | $\mu^c_{ht}(1, 0, \rho^r, \rho^c)$ versus $\mu^c_{ht}(1, 0, \rho^r, \rho^c)$ |  |
| Average Leaf-level C on R  | $\mu^r_{ht}(0, 1, \rho^r, \rho^c)$ versus $\mu^r_{ht}(1, 0, \rho^r, \rho^c)$ |  |
| Average Within-plant Spillover R on C  | $\mu^c_{ht}(0, 0, \rho^r, \rho^c)$ versus $\mu^c_{ht}(0, 0, \rho^{r\star}, \rho^c)$ |  |
| Average Within-plant Spillover C on R | $\mu^r_{ht}(0, 0, \rho^r, \rho^c)$ versus $\mu^r_{ht}(0, 0, \rho^{r}, \rho^{c\star})$ |  |


## Assumptions of this causal model

* no carryover effects


## Experiment

Describe the experiment that was run:

* experimental treatments
* what was measured

Describe study predictions or hypotheses.

## Estimation

* Description of statistical models
  * @barkley2017causal
  * account for ordering of leaves within host
* M-estimation for variance estimates

# Results

* Sensitively + stability analyses

# Discussion

* Data cannot distinguish between niche preemption or niche modification. Needs additional assumptions and knowledge, and this is even more complicated if a species can change from (e.g.) biotroph to necrotroph.
* a call for more causal in causal
* suggestions for better designs and how identifiability results might suggest better design
* links to other causal frameworks
    
## Other thoughts

* link back to @halliday2017interactions
  * is death of leaf a censoring event or competing risk? There's a complication that leaves only live a certain period of time - during which they are either infected or not - but it is not as if a leaf *could* survive for longer during which time we could observe the outcome. Then there's the fact that leaves in the last cohort can't be observed for the same length of time as other cohorts due to end of study and senesence. 
* link priority effects to causal mediation:
   * mediation - how an effect occurs; interaction - for whom an effect occurs [@vanderweele2015explanation]
   
# References